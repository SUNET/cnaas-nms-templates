{% extends "managed-full.j2" %}
{% block interfaces %}
{% for intf in interfaces %}
{% if (intf.data is defined) and intf.data %}
 {% if (intf.data.enabled is defined) and intf.data.enabled == false %}
  {% set enabled = false %}
 {% else %}
  {% set enabled = true %}
 {% endif %}
{% else %}
 {% set enabled = true %}
{% endif %}
interface {{ intf.name }}
{% if intf.ifclass == 'ACCESS_UPLINK' %}
 {% set description = 'UPLINK' %}
 switchport
 switchport mode trunk
 channel-group 1 mode active
{% elif intf.ifclass == 'ACCESS_AUTO' %}
 {% set description = 'DOT1X' %}
 switchport
 switchport mode access
 switchport access vlan 99
{% elif intf.ifclass == 'ACCESS_UNTAGGED' %}
 switchport
 switchport mode access
 {% if (intf.untagged_vlan is defined) and intf.untagged_vlan %}
 switchport access vlan {{ intf.untagged_vlan }}
 {% else %}
  {# shutdown port instead of risking accidentaly allowing default vlan #}
  {% set enabled = false %}
 {% endif %}
{% elif intf.ifclass == 'ACCESS_TAGGED' %}
 switchport
 switchport mode trunk
 {% if (intf.tagged_vlan_list is defined) and intf.tagged_vlan_list %}
  switchport trunk allowed vlan {{ intf.tagged_vlan_list|join(',') }}
 {% else %}
  {# shutdown port instead of risking accidentaly allowing all vlans on trunk #}
  {% set enabled = false %}
 {% endif %}
{% endif %}
{% if (intf.data is defined) and intf.data %}
 {% if (intf.data.description is defined) and intf.data.description %}
  description {{ intf.data.description }}
 {% elif (description is defined) and description %}
  description {{ description }}
 {% endif %}
{% endif %}
{% if (enabled is defined) and enabled == false %}
 shutdown
{% endif %}
{% endfor %}
interface port-channel 1
 description UPLINK
{% endblock %}
